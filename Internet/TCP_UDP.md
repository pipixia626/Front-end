
# TCP/UDP

## 前言
网络层只把分组发送到目的主机，但是真正通信的并不是主机而是主机中的进程。传输层提供了进程间的逻辑通信，
传输层向高层用户屏蔽了下面网络层的核心细节，使应用程序看起来像是在两个传输层实体之间有一条端到端的逻辑通信信道
## TCP/UDP 特点与区别

1：UDP是面向无连接的，面向报文的，没有拥塞控制的尽最大可能交付，支持一对一，一对多，多对多的通信

2：TCP是面向连接的，字节流的，提供可靠交付，全双工通信有拥塞控制，拥塞控制的点对点通信

## 首部格式
UDP
 16位源端口号  | 16位目的端口号 

 16位UDP长度   |  16位UDP校验和 
  
   |             32位数据              |
## TCP的三次握手和四次挥手

### TCP的三次握手（为什么三次）
1、第三次握手是为了防止失效的连接请求到达服务器，让服务器错误打开连接。

2、换个易于理解的视角来看为什么要 3 次握手。
客户端和服务端通信前要进行连接，“3次握手”的作用就是双方都能明确自己和对方的收、发能力是正常的。
### TCP的四次挥手（为什么四次）
服务器在客户端想关闭连接时，还有数据要传输，因此客户端需要多等待服务器端把数据传输完

### TIME_WAIT
客户端接收到服务器端的 FIN 报文后进入此状态，此时并不是直接进入 CLOSED 状态，还需要等待一个时间计时器设置的时间 2MSL。
这么做有两个理由：确保最后一个确认报文能够到达。如果 B 没收到 A 发送来的确认报文，那么就会重新发送连接释放请求报文，
A 等待一段时间就是为了处理这种情况的发生。

等待一段时间是为了让本连接持续时间内所产生的所有报文都从网络中消失，使得下一个新的连接不会出现旧的连接请求报文。


## TCP长连接和短连接的区别
短连接：Client 向 Server 发送消息，Server 回应 Client，然后一次读写就完成了，这时候双方任何一个都可以发起 close 操作，
不过一般都是 Client 先发起 close 操作。短连接一般只会在 Client/Server 间传递一次读写操作。
短连接的优点：管理起来比较简单，建立存在的连接都是有用的连接，不需要额外的控制手段。

长连接：Client 与 Server 完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。
在长连接的应用场景下，Client 端一般不会主动关闭它们之间的连接，Client 与 Server 之间的连接如果一直不关闭的话，
随着客户端连接越来越多，Server 压力也越来越大，这时候 Server 端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，
这样可以避免一些恶意连接导致 Server 端服务受损；如果条件再允许可以以客户端为颗粒度，限制每个客户端的最大长连接数，
从而避免某个客户端连累后端的服务。


## TCP粘包、拆包及解决办法

## TCP可靠传输
TCP 使用超时重传来实现可靠传输：如果一个已经发送的报文段在超时时间内没有收到确认，那么就重传这个报文段。
## TCP滑动窗口
窗口是缓存的一部分，用来暂时存放字节流，接收窗口左部字节已经发送确认并交付主机，就向右滑动接收窗口。

## 可靠的传输机制
捎带确认:接收方在会给发送方发送一个确认帧来告诉发送方收到了
超时重传:在发送某个数据帧之后，就开启一个计时器，开始计时，一旦超过某段时间还没有收到确认帧，就重新发送该数据帧

### 停等协议
发送窗口和接受窗口大小都是1
### 回退N协议

#### 解决问题
过长的往返时间严重影响带宽的利用率
#### 原理
发送窗口的大小>1，接收窗口的大小=1
接收端发现某一帧发生差错时，直接丢弃所有后续的帧，对丢弃帧不发送确认
数据链路层除了接收应该递交给网络层的下一帧之外，拒绝接收其它任何帧
发送方最终会超时，将按顺序重传所有未被确认的帧，即从最初受损或丢失的那一帧开始
接收端接收帧的顺序和发送端发出帧的顺序相同

#### 使用情况
回退n帧协议，如果错误率较低时，工作的很好
但错误率较高时，就会浪费大量的带宽在重传上

### 选择重传
接收方的数据链路层存储坏帧之后的所有正确的帧，当发送方得知某个帧出错时，只是重传此坏帧，而不是所有的后继帧
## TCP流量控制

## TCP拥塞控制

## 提高网络利用率
